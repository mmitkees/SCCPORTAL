<?xml version="1.0" encoding="US-ASCII" ?>
<!--Ant buildfile generated by Oracle JDeveloper-->
<!--Generated Sep 29, 2009 11:47:41 PM-->
<project name="WebCenterSpacesExtensionLibraryInternal" default="init" basedir="." 
         xmlns:wls="oracle.webcenter.tools.wls">

  <import file="internal-targets.xml"/>

  <property file="../config.properties"/>
  <property file="build.properties"/>

<taskdef resource="net/sf/antcontrib/antcontrib.properties">
  <classpath>
   <pathelement location="${jdeveloper.install.home.directory}/modules/net.sf.antcontrib_1.1.0.0_1-0b2/lib/ant-contrib.jar"/>
  </classpath>
</taskdef>
 
  <target name="init">
    <tstamp/>
    <mkdir dir="${output.dir}"/>
  </target>

  <target name="clean" description="Cleans the project">
    <echo> ---------------------------- </echo>
    <echo> ----Cleaning deploy directory  ---</echo>
    <echo> ---------------------------- </echo>


    <delete includeemptydirs="true" quiet="true">
      <fileset dir="${extending.spaces.home.dir}/deploy" includes="**/*"/>
      <fileset dir="${output.dir}" includes="**/*"/>
      <fileset dir="${oracle.jdeveloper.deploy.dir}" includes="**/*"/>
    </delete>
  </target>


   <target name="clean-local-manifest-file" 
        description="This target cleans up the locally created manifest 
        properties file">      
      <delete file="manifestImpl.properties" quiet="true"/>
   </target>
        
  <target name="pre-compile" 
          description="Specifies the version number for the manifest file">
    <echo> ---------------------------- </echo>
    <echo> ----Updating the manifest file with the
            correct version specification and implementation version
            ---</echo>
    <echo> ---------------------------- </echo>
      
    <!-- Checking if the restart number is set in property file, if not
    set then  setting to default-->
    <property value="${restart.implementation.version.suffix}" name="restartVer"/>
    <if>
      <length string="${restartVer}" when="greater" trim="true" length="30" />
      <then>
       <property name="propValue" value="1"/>
      </then>
      <else>
       <property name="propValue" value="${restartVer}"/>
      </else>
    </if>
   
  
    <if>
     <!--Checking if the manifest file is available -->
     <available file="manifestImpl.properties" property="propavailable"/>
     <then>
       <property file="manifestImpl.properties"/>
           <!--Getting the larger of the 2 numbers, from the properties
               and the local manifest file -->  
         <property value="${lastNumber}" name="lastCount"/>
          <if>
            <bool>
              <isgreaterthan arg1="${lastCount}" arg2="${propValue}"/>
            </bool>
             <then>
               <property name="valueToConsider" value="${lastCount}"/>
             </then>
             <else>
               <property name="valueToConsider" value="${propValue}"/>
             </else>
            </if>
         </then>
         <else>
            <!--Setting the property file if it does not exist--> 
           <propertyfile file="manifestImpl.properties"
                   comment="Implementation Version">
            <entry  key="implVersion" value="${default.implementation.version}"/>
           </propertyfile>
           <property name="valueToConsider" value="${propValue}"/>
         </else>
     </if>
    
     <!--From the obtained value incrementing the value by one--> 
     <var name="op1" value="${valueToConsider}"/>
     <var name="op2" value="1"/>
     <var name="op" value="+"/>

   
     <math result="result" operand1="${op1}" 
           operation="${op}" operand2="${op2}" datatype="int"/>
    
       <!--Setting the value in properties file--> 
     <propertyfile file="manifestImpl.properties">
       <entry  key="lastNumber" type="int" value="${result}"/>  
     </propertyfile>
   
    <property file="manifestImpl.properties"/>
    <property name="tempManifestImpelVersion" value="${implVersion}.${result}"/>

     <propertyfile file="manifestImpl.properties">
       <entry  key="manifest.implementation.version" 
               value="${tempManifestImpelVersion}"/>
     </propertyfile>

    <copy file="${manifest.template.directory}/MANIFEST.MF.TEMPL"
          tofile="${manifest.file.directory}/MANIFEST.MF"
          overwrite="true">
      <filterset>
       
        <filter token="IMPLEMENTATION_VERSION" 
             value="${tempManifestImpelVersion}"/>
      </filterset>
    </copy>
      
</target>

  <target name="stage" description="Deploy JDeveloper profiles" 
          depends="init, pre-compile">
    <echo> ---------------------------- </echo>
    <echo> ----Compiling Custom Landing Page ---</echo>
    <echo> ---------------------------- </echo>

    <taskdef name="ojdeploy"
             classname="oracle.jdeveloper.deploy.ant.OJDeployAntTask"
             uri="oraclelib:OJDeployAntTask"
             classpath="${oracle.jdeveloper.ant.library}"/>


    <echo> ---------------------------- </echo>
    <echo> ----Compling Custom WebCenterSpaces ---</echo>
    <echo> ---------------------------- </echo>

    <ora:ojdeploy xmlns:ora="oraclelib:OJDeployAntTask"
                  executable="${oracle.jdeveloper.ojdeploy.path}"
                  ora:buildscript="${oracle.jdeveloper.deploy.dir}/ojdeploy-build.xml"
                  ora:statuslog="${oracle.jdeveloper.deploy.dir}/ojdeploy-statuslog.xml">
      <ora:deploy>

        <ora:parameter name="workspace"
                       value="${oracle.jdeveloper.workspace.path}"/>
        <ora:parameter name="project"
                       value="WebCenterSpacesExtensionLibrary"/>
        <ora:parameter name="profile"
                       value="custom_webcenter_spaces_war"/>
        <ora:parameter name="nocompile" value="false"/>
        <ora:parameter name="outputfile"
                       value="${oracle.jdeveloper.deploy.outputfile}"/>
      </ora:deploy>
      
    </ora:ojdeploy>
    <echo> Wrote the war to the following 
         location ${oracle.jdeveloper.deploy.dir}/${shared.library.name} </echo>
    <mkdir dir="${oracle.jdeveloper.deploy.dir}/exploded"/>
    <mkdir dir="${oracle.jdeveloper.deploy.dir}/exploded/extend.spaces.webapp.war"/>
    <unzip src="${oracle.jdeveloper.deploy.dir}/${shared.library.name}" 
           dest="${oracle.jdeveloper.deploy.dir}/exploded/extend.spaces.webapp.war"/>

  </target>
  
 
   <target name="init-wls">
     <path id="wls.classpath">
       <pathelement path="${wls.home}/server/lib/weblogic.jar"/>
       <pathelement path="${wls.home}/server/lib/xqrl.jar"/>
     </path>
     <taskdef name="wldeploy" classpathref="wls.classpath" 
             classname="weblogic.ant.taskdefs.management.WLDeploy"/>
            
    </target>
   

</project>
          
